!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.encodeMsgpack=r()}(this,function(){"use strict";function t(t,r,e){for(var n=(t.byteLength,0),i=e.length;i>n;n++){var f=e.charCodeAt(n);if(128>f)t.setUint8(r++,f>>>0&127|0);else if(2048>f)t.setUint8(r++,f>>>6&31|192),t.setUint8(r++,f>>>0&63|128);else if(65536>f)t.setUint8(r++,f>>>12&15|224),t.setUint8(r++,f>>>6&63|128),t.setUint8(r++,f>>>0&63|128);else{if(!(1114112>f))throw new Error("bad codepoint "+f);t.setUint8(r++,f>>>18&7|240),t.setUint8(r++,f>>>12&63|128),t.setUint8(r++,f>>>6&63|128),t.setUint8(r++,f>>>0&63|128)}}}function r(t){for(var r=0,e=0,n=t.length;n>e;e++){var i=t.charCodeAt(e);if(128>i)r+=1;else if(2048>i)r+=2;else if(65536>i)r+=3;else{if(!(1114112>i))throw new Error("bad codepoint "+i);r+=4}}return r}function e(n,i,f){var o=typeof n;if("string"===o){var s=r(n);if(32>s)return i.setUint8(f,160|s),t(i,f+1,n),1+s;if(256>s)return i.setUint8(f,217),i.setUint8(f+1,s),t(i,f+2,n),2+s;if(65536>s)return i.setUint8(f,218),i.setUint16(f+1,s),t(i,f+3,n),3+s;if(4294967296>s)return i.setUint8(f,219),i.setUint32(f+1,s),t(i,f+5,n),5+s}if(n instanceof ArrayBuffer){var s=n.byteLength;if(256>s)return i.setUint8(f,196),i.setUint8(f+1,s),new Uint8Array(i.buffer).set(new Uint8Array(n),f+2),2+s;if(65536>s)return i.setUint8(f,197),i.setUint16(f+1,s),new Uint8Array(i.buffer).set(new Uint8Array(n),f+3),3+s;if(4294967296>s)return i.setUint8(f,198),i.setUint32(f+1,s),new Uint8Array(i.buffer).set(new Uint8Array(n),f+5),5+s}if("number"===o){if(!isFinite(n))throw new Error("Number not finite: "+n);if(Math.floor(n)!==n)return i.setUint8(f,203),i.setFloat64(f+1,n),9;if(n>=0){if(128>n)return i.setUint8(f,n),1;if(256>n)return i.setUint8(f,204),i.setUint8(f+1,n),2;if(65536>n)return i.setUint8(f,205),i.setUint16(f+1,n),3;if(4294967296>n)return i.setUint8(f,206),i.setUint32(f+1,n),5;throw new Error("Number too big 0x"+n.toString(16))}if(n>=-32)return i.setInt8(f,n),1;if(n>=-128)return i.setUint8(f,208),i.setInt8(f+1,n),2;if(n>=-32768)return i.setUint8(f,209),i.setInt16(f+1,n),3;if(n>=-2147483648)return i.setUint8(f,210),i.setInt32(f+1,n),5;throw new Error("Number too small -0x"+(-n).toString(16).substr(1))}if(null===n)return i.setUint8(f,192),1;if("boolean"===o)return i.setUint8(f,n?195:194),1;if("object"===o){var s,u=0,a=Array.isArray(n);if(a)s=n.length;else{var U=Object.keys(n);s=U.length}var u;if(16>s?(i.setUint8(f,s|(a?144:128)),u=1):65536>s?(i.setUint8(f,a?220:222),i.setUint16(f+1,s),u=3):4294967296>s&&(i.setUint8(f,a?221:223),i.setUint32(f+1,s),u=5),a)for(var w=0;s>w;w++)u+=e(n[w],i,f+u);else for(var w=0;s>w;w++){var l=U[w];u+=e(l,i,f+u),u+=e(n[l],i,f+u)}return u}throw new Error("Unknown type "+o)}function n(t){var e=typeof t;if("string"===e){var i=r(t);if(32>i)return 1+i;if(256>i)return 2+i;if(65536>i)return 3+i;if(4294967296>i)return 5+i}if(t instanceof ArrayBuffer){var i=t.byteLength;if(256>i)return 2+i;if(65536>i)return 3+i;if(4294967296>i)return 5+i}if("number"===e){if(Math.floor(t)!==t)return 9;if(t>=0){if(128>t)return 1;if(256>t)return 2;if(65536>t)return 3;if(4294967296>t)return 5;throw new Error("Number too big 0x"+t.toString(16))}if(t>=-32)return 1;if(t>=-128)return 2;if(t>=-32768)return 3;if(t>=-2147483648)return 5;throw new Error("Number too small -0x"+t.toString(16).substr(1))}if("boolean"===e||null===t)return 1;if("object"===e){var i,f=0;if(Array.isArray(t)){i=t.length;for(var o=0;i>o;o++)f+=n(t[o])}else{var s=Object.keys(t);i=s.length;for(var o=0;i>o;o++){var u=s[o];f+=n(u)+n(t[u])}}if(16>i)return 1+f;if(65536>i)return 3+f;if(4294967296>i)return 5+f;throw new Error("Array or object too long 0x"+i.toString(16))}throw new Error("Unknown type "+e)}function i(t){var r=new ArrayBuffer(n(t)),i=new DataView(r);return e(t,i,0),new Uint8Array(r)}return i});